<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forex 3-Candle Forecast – Full Data</title>
<style>
    body { font-family: Arial; background:#111; color:#eee; display:flex; justify-content:center; padding:20px;}
    #dashboard { width:400px; text-align:center;}
    select { padding:5px; font-size:16px; margin:5px;}
    table { width:100%; margin-top:20px; border-collapse:collapse; }
    th, td { padding:6px; border-bottom:1px solid #444; text-align:center;}
</style>
</head>
<body>
<div id="dashboard">
    <h2>3-Candle Forecast – Full Data</h2>

    <label for="pairSelect">Pair:</label>
    <select id="pairSelect">
        <option value="EUR/USD">EUR/USD</option>
        <option value="GBP/USD">GBP/USD</option>
        <option value="USD/JPY">USD/JPY</option>
        <option value="USD/CHF">USD/CHF</option>
        <option value="USD/CAD">USD/CAD</option>
        <option value="AUD/USD">AUD/USD</option>
        <option value="NZD/USD">NZD/USD</option>
    </select>

    <label for="tfSelect">Timeframe:</label>
    <select id="tfSelect">
        <option value="1min">1m</option>
        <option value="3min">3m</option>
        <option value="5min">5m</option>
    </select>

    <div id="countdown">Next Candle in: 00:00</div>

    <table>
        <thead>
            <tr>
                <th>Candle</th>
                <th>Prob Higher</th>
                <th>Prob Lower</th>
            </tr>
        </thead>
        <tbody id="forecastBody">
            <tr><td>1</td><td>0</td><td>0</td></tr>
            <tr><td>2</td><td>0</td><td>0</td></tr>
            <tr><td>3</td><td>0</td><td>0</td></tr>
        </tbody>
    </table>
</div>

<script>
const apiKey = "YOUR_TWELVE_DATA_API_KEY"; // <-- Replace with your API key
const pairSelect = document.getElementById("pairSelect");
const tfSelect = document.getElementById("tfSelect");
const forecastBody = document.getElementById("forecastBody");
const countdownEl = document.getElementById("countdown");

let countdown = 60;

// Countdown timer
setInterval(() => {
    countdown--;
    if (countdown < 0) countdown = 60;
    let min = Math.floor(countdown/60).toString().padStart(2,'0');
    let sec = (countdown%60).toString().padStart(2,'0');
    countdownEl.textContent = `Next Candle in: ${min}:${sec}`;
}, 1000);

// Forecast probabilities using all available data
async function updateForecast() {
    const pair = pairSelect.value.replace("/","");
    const interval = tfSelect.value;

    try {
        const res = await fetch(`https://api.twelvedata.com/time_series?symbol=${pair}&interval=${interval}&outputsize=5000&apikey=${apiKey}`);
        const data = await res.json();
        if(!data.values) return;

        const prices = data.values.map(c=>parseFloat(c.close));

        // Calculate probabilities using ALL available data
        let upCount = 0;
        for(let i=1;i<prices.length;i++){
            if(prices[i] > prices[i-1]) upCount++;
        }
        const probUp = upCount / (prices.length-1);
        const probDown = 1 - probUp;

        // Forecast next 3 candles
        const forecast = [probUp, probUp, probUp];

        // Update table
        forecastBody.innerHTML = "";
        forecast.forEach((p,i)=>{
            const row = document.createElement("tr");
            row.innerHTML = `<td>${i+1}</td><td>${p.toFixed(2)}</td><td>${(1-p).toFixed(2)}</td>`;
            forecastBody.appendChild(row);
        });

    } catch(err){
        console.error(err);
    }
}

pairSelect.addEventListener("change", ()=>{ countdown=60; updateForecast(); });
tfSelect.addEventListener("change", ()=>{ countdown=60; updateForecast(); });

// Initial fetch & update every 15s
updateForecast();
setInterval(updateForecast,15000);

</script>
</body>
</html>
